---
title: 20190513个人工作
date: 2019-05-14 9:30:48
tags: 拥塞控制
---
翻看何江师兄发的文档
# 基于时延的拥塞控制
将时延的增加视为出现拥塞，时延增加时减小拥塞窗口，延时降低时增加拥塞窗口
## Vegas
通过比较实际吞吐量和期望吞吐量来调节拥塞窗口的大小。  
期望吞吐量：Expected=cwnd/BaseRTT
实际吞吐量：Actual=cwnd/RTT
**diff**=(Expected-Actual)*BaseRTT
**BaseRTT**是所有观测来回响应时间的最小值。
* 当a ≤ diff ≤ b 时，拥塞窗口不变
* 当diff < a 时，拥塞窗口增加
* 当diff > b 时，拥塞窗口减小  
  
当网络中Vegase算法与基于丢包的拥塞控制算法共存的情况下，后者会去尝试填满网络中的缓冲区，导致Vegas计算的RTT增大，进而使得传输速度越来越慢。
##基于链路容量的拥塞控制
实时测量网络带宽和时延，认为网络上报文总量大于带宽和时延的乘积时出现了拥塞。
## BBR
周期性探测网络的容量，交替测量一段时间内的带宽极大值和时延极小值，将其乘积作为拥塞窗口大小，保持拥塞窗口的值始终和网络的容量保持一致。
* **RTprop**：往返时延
  光信号从A端到B端的最小时延(其实是二倍时延，因为是一个来回)
* **BtlBW(bottleneck bandwidth)**：瓶颈带宽
  A到B的链路中，它的带宽取决于最慢的那段链路的带宽，即为瓶颈带宽
* **inflight data**：干扰数据
  A已经发出但未收到B返回的ACK数据
* **BDP(bandwidth-delay product)**：时延带宽积
  BDP=BtlBW*RTprop
* **pacing_gain**：控制发送速度的增益系数
* **cwnd_gain**：窗口增益系数
  与BDP相乘，控制inflight数量
* **min_rtt**：windows_min(rtt,10 seconds)
* **pacing_rate**：pacing_gain * bw
* **cwnd**：max(cwnd_gain * bw * min_rtt)
* **FQ(Fair queue)**：公平队列
  根据bbr设置的pacing rate将一个cwnd内的数据的发送从“突发到网络”这种行为变换到“平缓发送到网络”的行为。
#### 1.测量瓶颈带宽和往返时延  
BBR解决带宽和延迟无法同时测准的方法是：交替测量带宽和延迟；用一段时间内的带宽极大值和延迟极小值作为估计值。
最大带宽的值可以用win_minmax计算。保存一个时间窗口内的“最有意义的最大值或者最小值”，在时间流逝的过程中，时间窗口不断向后华东，在需要时间窗口内极值的时候只需取保存的三个值中的第一个值即可。win_minmax算法本身保证了时间窗口随着时间的华东以及窗口内极值的冒泡更新。