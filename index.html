<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="我是你皇叔">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="我是你皇叔">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="我是你皇叔">





  
  
  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>我是你皇叔</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">我是你皇叔</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/03/NS2学习笔记（三）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="皇叔">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我是你皇叔">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/03/NS2学习笔记（三）/" class="post-title-link" itemprop="url">NS2学习笔记（三）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-03 11:52:37 / 修改时间：19:32:53" itemprop="dateCreated datePublished" datetime="2019-06-03T11:52:37+08:00">2019-06-03</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="NS2节点"><a href="#NS2节点" class="headerlink" title="NS2节点"></a>NS2节点</h1><p>节点是网络拓扑的重要组成部分，是NS2符合网络组件的一个大类。这里对应NS手册的第五章。</p>
<h2 id="节点基本元素"><a href="#节点基本元素" class="headerlink" title="节点基本元素"></a>节点基本元素</h2><p>建立节点基本命令：<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> ns [new Simulator]</span><br><span class="line">$ns node</span><br></pre></td></tr></table></figure></p>
<p>一个（单播）节点的典型结构包含两个TclObject：一个地址分类器（classifier_）和一个端口分类器（dmux_）。这些分类器的功能是将传入的包分派至正确的代理或者链路出口去。<br>每个节点至少包含以下部分：</p>
<ul>
<li>一个地址或（id_），初始值为0，当节点建立时，模拟的名字控件将自动加1；</li>
<li>一个邻居链表（neighbor_）；</li>
<li>一个代理链表（agnet_）;</li>
<li>一个节点类型识别器（nodetype_）；</li>
<li>一个路由模块</li>
</ul>
<p>建立多播节点时需要进行设置<br><code>set ns [new Simulator -multicast on]</code></p>
<h2 id="设置节点"><a href="#设置节点" class="headerlink" title="设置节点"></a>设置节点</h2><h3 id="控制函数"><a href="#控制函数" class="headerlink" title="控制函数"></a>控制函数</h3><ul>
<li>$node entry：返回节点的入口指针</li>
<li>$node reset：重新设置节点上的所有代理<h3 id="地址和端口号管理"><a href="#地址和端口号管理" class="headerlink" title="地址和端口号管理"></a>地址和端口号管理</h3></li>
<li>$node id：返回节点的节点号，该号码是在类Simulator用方法$ns node创建每个节点自动生成和赋值的</li>
<li>$node agent(port)：返回一个端口号为port的代理的句柄。若代理不存在则返回空字符串。</li>
<li>add-route和add-toutes：单播的时候用来增加路由路径从而产生classifier_。使用语法为<code>$node add-route &lt;destination id&gt; &lt;TclObject&gt;</code>。TclObject是dmux_的入口，节点的多路复用端口。add-routes用于已添加多重路由路径到同一个目的地。</li>
<li>delete-routes()</li>
<li>init-routing()和rtObject()。前者设置实例变量mutiPath_，使之与同名的类变量相同。同时给该节点的路由控制器对象增加一个实例变量rtObject_；后者返回该节点的路由对象的句柄。</li>
</ul>
<p>最后，当节点上的一个链路关联改变状态时，过程intf-changed()可以被网络动态代码激活。</p>
<h3 id="代理管理"><a href="#代理管理" class="headerlink" title="代理管理"></a>代理管理</h3>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/03/C-不知名库函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="皇叔">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我是你皇叔">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/03/C-不知名库函数/" class="post-title-link" itemprop="url">C++不知名库函数</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-03 10:10:52" itemprop="dateCreated datePublished" datetime="2019-06-03T10:10:52+08:00">2019-06-03</time>
            

            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/31/NS2学习笔记（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="皇叔">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我是你皇叔">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/31/NS2学习笔记（二）/" class="post-title-link" itemprop="url">NS2学习笔记（二）——分裂对象模型</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-31 15:40:09" itemprop="dateCreated datePublished" datetime="2019-05-31T15:40:09+08:00">2019-05-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-03 11:52:12" itemprop="dateModified" datetime="2019-06-03T11:52:12+08:00">2019-06-03</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="解释器相关类的介绍和用途"><a href="#解释器相关类的介绍和用途" class="headerlink" title="解释器相关类的介绍和用途"></a>解释器相关类的介绍和用途</h1><h2 id="Tcl类"><a href="#Tcl类" class="headerlink" title="Tcl类"></a>Tcl类</h2><p>封装了OTcl解释器的实例，并提供了访问解释器的方法，提供访问Tcl库的接口。该类提供如下操作方法：</p>
<ul>
<li><strong>1、获取Tcl实例句柄</strong><br>Tcl类只有一个实例，该实例在NS2启动时初始化，获取Tcl类的实例方法是<br><code>Tcl&amp; tcl = Tcl::instance();</code></li>
<li><p><strong>2、用来调用OTcl命令函数</strong><br>获得Tcl解释器引用之后可通过这个引用来调用OTcl中的控制台命令，现有4中方法通过Tcl实例来调用OTcl命令，主要区别是调用函数的不同。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tcl.eval(s)               <span class="comment">//执行已经存储进tcl返回区的命令，并返回给结果变量</span></span><br><span class="line">tcl.eval(<span class="keyword">char</span>* s)         <span class="comment">//执行字符串s，并在tcl的结果变量中保存执行结果</span></span><br><span class="line">tcl.evalc(<span class="keyword">const</span> cahr* s)  <span class="comment">//首先把s存储进tcl的命令缓冲区，然后在执行s命令，并在结果变量中返回结果</span></span><br><span class="line">tcl.evalf(<span class="keyword">const</span> <span class="keyword">char</span>* s,...)  <span class="comment">//类似于c语言中的printf命令，可以进行字符串的过滤，执行同tcl.evalc。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>3、传递/返回OTcl命令运行的结果</strong><br>当C++程序中调用一个OTcl命令是，解释器将执行结果保存在私有成员变量tcl_-&gt;results中，用户必须用tcl.result(void)来获取该执行结果，若结果是字符串，必须被转换为适当的类型。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tcl.evalc(<span class="string">"Simulator set NumberInterfaces_"</span>);</span><br><span class="line">cahr *ni = tcl.result();</span><br><span class="line"><span class="keyword">if</span>( atoi(ni)!=<span class="number">1</span> ) <span class="comment">//将字符串转换成整数</span></span><br><span class="line">  tcl.evalc(Simulator <span class="built_in">set</span> NumberInterfaces_1);</span><br></pre></td></tr></table></figure>
<p>Tcl类的结果返回，与脚本执行的退出码也有所不同，例如</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( <span class="built_in">strcmp</span>(argv[<span class="number">1</span>],<span class="string">"now"</span>) == <span class="number">0</span> )&#123;</span><br><span class="line">    tcl.resultf(<span class="string">"%.17g"</span>,clock());</span><br><span class="line">    <span class="keyword">return</span> TCL_OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>4、存储并查询TclObject对象</strong><br>在NS2中的Tcl命令解释器中保存了一个存储对象地址的哈希表，NS2为每一个在模拟过程中生成的TclObject类以及派生类的对象在该哈希表中保存了一个指针，用于快速查找这些对象。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Tcl.enter(TclObjuct* o)   <span class="comment">//在哈希表中加入一个对象</span></span><br><span class="line">Tcl.lookup(<span class="keyword">char</span>* s)       <span class="comment">//在哈希表中查询名字为s的对象并返回</span></span><br><span class="line">Tcl.remove(TclObject* o)  <span class="comment">//在哈希表中删除该对象的地址</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>5、获的Tcl解释器的句柄，来对解释器进行直接访问</strong><br>函数<code>Tcl.interp(void)</code>是Tcl的解释器句柄，可以对其进行修改，加入自己的解释器。</p>
<h2 id="TclObject类"><a href="#TclObject类" class="headerlink" title="TclObject类"></a>TclObject类</h2><p>TclObject类是OTcl/C++两个面向对象语言的类的基库，封装了绑定、跟踪和对相关命令的调用机制。</p>
</li>
<li><p>1、创建/清除模拟器组件的对象</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> tcp1 [<span class="keyword">new</span> Agent/TCP]</span><br><span class="line"><span class="keyword">delete</span> $tcp1</span><br></pre></td></tr></table></figure>
</li>
<li><p>2、实现从C++类成员变量到OTcl类成员变量的绑定</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bind(<span class="string">"distance_"</span>,&amp;distance)   <span class="comment">//绑定实数变量</span></span><br><span class="line">bind_time(<span class="string">"lastSent_"</span>,&amp;lastSessSent)   <span class="comment">//绑定时间变量</span></span><br><span class="line">bind_bw       <span class="comment">//绑定带宽变量</span></span><br><span class="line">bind_boll     <span class="comment">//绑定布尔型变量</span></span><br></pre></td></tr></table></figure>
<p>以上一个是OTcl变量名，一个是对应C++成员变量地址。</p>
</li>
<li>3、实现变量跟踪</li>
<li>4、实现从C++类的成员函数到OTcl类的成员函数之间的一一对应<br>  通过command()函数事项。由于command()是TclObject的成员函数，所以它的派生类的每个对象都可以重写该函数。  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">argc:命令行参数个数</span></span><br><span class="line"><span class="comment">*argv:命令行参数向量：argv[0]:cmd;argv[1]指定想要的操作;argv[2...argc-1]用户还指定的参数</span></span><br><span class="line"><span class="comment">参数以字符串形式给出，若操作匹配成功则返回操作结果；若操作不匹配则调用父类command()一直到匹配为止，若都不匹配则返回错误信号</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Int MobileNode::command(<span class="keyword">int</span> argc,<span class="keyword">const</span> <span class="keyword">char</span>*<span class="keyword">const</span>* argv)</span><br><span class="line">&#123;</span><br><span class="line">  Tcl&amp;tcl = Tcl::instance();</span><br><span class="line">  <span class="keyword">if</span>( argc == <span class="number">5</span> )&#123;</span><br><span class="line">    <span class="keyword">if</span>( <span class="built_in">strcmp</span>(argv[<span class="number">1</span>],<span class="string">"setdest"</span>)==<span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span>( set_destination( atof(argv[<span class="number">2</span>]),atof(argv[<span class="number">3</span>]),atof(argv[<span class="number">4</span>]) )&lt;<span class="number">0</span> )</span><br><span class="line">      <span class="keyword">return</span> TCL_ERROR;</span><br><span class="line">      <span class="keyword">return</span> TCL_OK;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>( SRMAgent::command(argc,argv) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="TclClass类"><a href="#TclClass类" class="headerlink" title="TclClass类"></a>TclClass类</h2><p>TclClass类用于注册编译，保持了编译分级的层次结构，同时给OTcl对象提供了创建C++对象的方法。<br><code>set o [new B/A]</code><br>对象o的解释构造函数在ns第一次启动时执行：</p>
<ul>
<li>次构造函数以解释器类的名字B/A调用ABClass的构造函数；</li>
<li>然后，ABClass构造函数调用其父类TclClass的构造函数；</li>
<li>TclClass构造函数存储类的名字，并将对象插入TclClass对象链中；</li>
<li>在simulator的初始化过程中，Tcl_AppInit(void)调用TclClass::bind(void)。bind()调用以解释类的名字作为参数的register{},register{}建立类层次，生成需要却还没有的类；</li>
<li>最后，bind()为新类定义实例过程create-shadow和delete-shadow，生成并返回对象o。<h2 id="TclCommand类"><a href="#TclCommand类" class="headerlink" title="TclCommand类"></a>TclCommand类</h2>TclCommand类用于定义简单的全局解释命令。TclCommand类也是纯虚函数。需要派生类实现两个成员函数：构造函数和command()。<h2 id="EmbeddedTcl类"><a href="#EmbeddedTcl类" class="headerlink" title="EmbeddedTcl类"></a>EmbeddedTcl类</h2>用户对脚本~tclcl/tcl-object.tck进行修改，增加tcl/lib的文件来对ns进行扩展。对于新文件的装载是由该类完成的。<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> EmbeddedTcl::load()&#123;</span><br><span class="line">  Tcl::instance().evalc(code_);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="InstVar类"><a href="#InstVar类" class="headerlink" title="InstVar类"></a>InstVar类</h2><p>包含了从OTcl访问C++类成员变量的方法。</p>
<h1 id="OTcl与C-之间的连接"><a href="#OTcl与C-之间的连接" class="headerlink" title="OTcl与C++之间的连接"></a>OTcl与C++之间的连接</h1><p>主要实现以下三个功能：</p>
<ul>
<li>动态创建一个新的C++对象；</li>
<li>访问该C++对象的属性；</li>
<li>调用该C++对象的方法。<h2 id="调用C-对象的方法"><a href="#调用C-对象的方法" class="headerlink" title="调用C++对象的方法"></a>调用C++对象的方法</h2></li>
<li>注册顶级命令<br>使用command方法</li>
<li>暴露C++对象方法</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/29/NS2学习笔记（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="皇叔">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我是你皇叔">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/29/NS2学习笔记（一）/" class="post-title-link" itemprop="url">NS2学习笔记（一）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-29 15:58:38" itemprop="dateCreated datePublished" datetime="2019-05-29T15:58:38+08:00">2019-05-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-31 15:39:31" itemprop="dateModified" datetime="2019-05-31T15:39:31+08:00">2019-05-31</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="TCL简介"><a href="#TCL简介" class="headerlink" title="TCL简介"></a>TCL简介</h1><h2 id="变量和变量赋值"><a href="#变量和变量赋值" class="headerlink" title="变量和变量赋值"></a>变量和变量赋值</h2><p>无需事先声明，使用set指令对变量进行首次赋值，使用变量时前面要加$符号。<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> a <span class="string">"hello world"</span></span><br><span class="line"><span class="keyword">puts</span> <span class="string">"NS2 say $"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>使用双引号将其括起来为单词赋值。</p>
<h2 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h2><p>tcl包含很多表达式，使用expr指令求数学表达式的值或关系表达式的真假。<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> value [<span class="keyword">expr</span> <span class="number">2</span>+<span class="number">3</span>]</span><br></pre></td></tr></table></figure></p>
<h2 id="指令替代"><a href="#指令替代" class="headerlink" title="指令替代"></a>指令替代</h2><p>使用中括号进行指令替代。指令替代可以将“tcl脚本的执行结果”取代“tcl脚本”。<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">puts</span> <span class="string">"I am [expr 10*2] years old"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><ul>
<li><p>选择结构</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>&#123;$a==<span class="string">"hello"</span>&#125;&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">else <span class="keyword">if</span>&#123;&#125;&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> $a&#123;</span><br><span class="line">    <span class="number">2</span> &#123;<span class="keyword">puts</span> $a&#125;</span><br><span class="line">    <span class="number">3</span> &#123;&#125;</span><br><span class="line">    default &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>循环结构</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123;<span class="keyword">set</span> i <span class="number">0</span>&#125;&#123;$i&lt;<span class="number">5</span>&gt;&#125;&#123;<span class="keyword">incr</span> i <span class="number">1</span>&#125;&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>( $i&lt;<span class="number">5</span> )&#123;</span><br><span class="line">    <span class="keyword">incr</span> i <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> vowel &#123;a e i o u&#125;&#123;</span><br><span class="line">    <span class="keyword">puts</span> <span class="string">"$vowel is a vowel"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>与c++函数类似<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">proc</span><span class="title"> sum_proc</span> &#123;a b&#125;&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">expr</span> $a + $b]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">puts</span> <span class="string">"sum is [sum_proc 1 2]"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>无需像C语言一样需要事先声明数组大小<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> a(<span class="number">0</span>) <span class="string">"Zero"</span></span><br><span class="line"><span class="keyword">puts</span> $a(0)</span><br></pre></td></tr></table></figure></p>
<h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> f [<span class="keyword">open</span> <span class="string">"filename"</span> <span class="string">"w/r"</span>]</span><br><span class="line"><span class="keyword">puts</span> $f <span class="string">"1"</span></span><br><span class="line"><span class="keyword">close</span> $f</span><br></pre></td></tr></table></figure>
<h2 id="eval命令"><a href="#eval命令" class="headerlink" title="eval命令"></a>eval命令</h2><p>语法：<code>eval arg1.arg2.arg3,...</code><br>含义：将所有的参数连起来作为命令语句执行<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">file</span>.txt中存放</span><br><span class="line"><span class="number">1</span> + <span class="number">2</span></span><br><span class="line"><span class="number">4</span> + <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> infile [<span class="keyword">open</span> <span class="string">"/file.txt"</span> <span class="string">"r"</span>]</span><br><span class="line"><span class="keyword">while</span> &#123;[<span class="keyword">gets</span> $infile Op]&lt;=<span class="number">0</span>&#125;&#123;</span><br><span class="line">    <span class="keyword">set</span> Operation <span class="string">"expr $Op"</span></span><br><span class="line">    <span class="keyword">set</span> results [<span class="keyword">eval</span> $Operation]</span><br><span class="line">    <span class="keyword">puts</span> stdout <span class="string">"$Op = $Results\n"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>动态构造Tcl命令，然后解析并执行。</p>
<h2 id="error和catch命令"><a href="#error和catch命令" class="headerlink" title="error和catch命令"></a>error和catch命令</h2><p>相当于throw expection.<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">proc</span><span class="title"> div</span> &#123;a b&#125;&#123;</span><br><span class="line">    <span class="keyword">if</span>&#123;$b==<span class="number">0</span>&#125;&#123;</span><br><span class="line">        <span class="keyword">error</span> <span class="string">"divided by zero"</span></span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="keyword">expr</span> $a/$b]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">div <span class="number">1</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<h2 id="upvar和uplevel命令"><a href="#upvar和uplevel命令" class="headerlink" title="upvar和uplevel命令"></a>upvar和uplevel命令</h2><ul>
<li><p>upvar可以使用户在过程中对全局变量或者其他过程中的局部变量进行访问</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">proc</span><span class="title"> decer</span> &#123;n m&#125;&#123;</span><br><span class="line">  <span class="keyword">upvar</span> $n upa</span><br><span class="line">  <span class="keyword">set</span> upa [<span class="keyword">expr</span> $upa-$m]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span> nb <span class="number">12</span></span><br><span class="line">decer nb <span class="number">3</span></span><br><span class="line"><span class="keyword">puts</span> $nb</span><br></pre></td></tr></table></figure>
</li>
<li><p>uplevel可以改变上一级栈中的变量值</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">proc</span><span class="title"> ff</span> &#123;&#125;&#123;</span><br><span class="line">    <span class="keyword">set</span> a ff #设置了局部的a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span> a <span class="keyword">global</span></span><br><span class="line">ff</span><br><span class="line"><span class="keyword">puts</span> $a</span><br><span class="line">输出结果： <span class="keyword">global</span></span><br><span class="line">对比：</span><br><span class="line"><span class="keyword">proc</span><span class="title"> ff</span>&#123;&#125;&#123;</span><br><span class="line">    <span class="keyword">uplevel</span> <span class="keyword">set</span> a ff # 改变了上一级栈中的a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span> a <span class="keyword">global</span></span><br><span class="line">ff</span><br><span class="line"><span class="keyword">puts</span> $a</span><br><span class="line">输出:ff</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="OTcl简介"><a href="#OTcl简介" class="headerlink" title="OTcl简介"></a>OTcl简介</h1><h2 id="OTcl和C-的区别"><a href="#OTcl和C-的区别" class="headerlink" title="OTcl和C++的区别"></a>OTcl和C++的区别</h2><ul>
<li>C++在一对{}中完成对一个类的定义，而OTcl则是写成多个分开的部分，每一个方法给类增加一个成员函数，OTcl中成员变量是在成员函数中定义。</li>
<li>C++中的构造函数和析构函数对应OTcl语言中的init函数和destroy函数。OTcl中必须用next显式地调用父类的构造函数。</li>
<li>OTcl函数必须通过对象来调用。变量$self和C++中的this相似，表示对象自身。OTcl函数都是虚函数。</li>
<li>OTcl同样可以继承，，使用next关键字调用父类函数<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2>使用<code>instproc</code>定义类的方法，使用<code>proc</code>定义对象的方法，<code>proc</code>定义的方法只能用于该对象<h3 id="类的定义和生成"><a href="#类的定义和生成" class="headerlink" title="类的定义和生成"></a>类的定义和生成</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">% Class Box //使用关键字Class定义一个类Box</span><br><span class="line">% Box box1  //产生类的对象</span><br><span class="line">% box1 info Class   //使用info命令查看类和对象的关系</span><br><span class="line">% Box info instances</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>产生对象之后对，对对象进行变量定义，也可通过info命令来查看对象的变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">% box1 set length 10</span><br><span class="line">% box1 info vars</span><br><span class="line">length</span><br></pre></td></tr></table></figure></p>
<h3 id="init函数和destroy函数"><a href="#init函数和destroy函数" class="headerlink" title="init函数和destroy函数"></a>init函数和destroy函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">% Box instproc init &#123;args&#125;&#123;</span><br><span class="line">    $self set length 10</span><br><span class="line">    eval $self next $args</span><br><span class="line">&#125;</span><br><span class="line">% Box instproc destroy &#123;args&#125;&#123;</span><br><span class="line">    puts &quot;The instance is destroyed!&quot;</span><br><span class="line">    $self next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>OTcl支持类的多继承，唯一的要求是继承关系满足有向无环图。superclass用于声明继承。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Class Box</span><br><span class="line">Box instproc init&#123;&#125;&#123;    #定义类的初始函数</span><br><span class="line">    $self <span class="built_in">set</span> count0</span><br><span class="line">    $self next</span><br><span class="line">&#125;</span><br><span class="line">Box instproc Count&#123;&#125;&#123;   #定义类的成员函数Count</span><br><span class="line">    $self instvar count #重新声明变量count</span><br><span class="line">    incr count</span><br><span class="line">    $self next</span><br><span class="line">&#125;</span><br><span class="line">Safety instproc Count&#123;&#125;&#123;</span><br><span class="line">    $self instvar count</span><br><span class="line">    <span class="keyword">if</span>&#123;$count == <span class="number">0</span>&#125;&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;zero&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123; $count &#125;</span><br><span class="line">    $self next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class redBox -superclass Box    #redBox继承于类Box</span><br><span class="line">redBox redBox1</span><br><span class="line"></span><br><span class="line">redBox instproc init &#123;args&#125;&#123;</span><br><span class="line">    $self <span class="built_in">set</span> toppings&#123;&#125;</span><br><span class="line">    eval $self next $args       #调用父类Box的初始化函数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">% redBox1 <span class="built_in">set</span> count</span><br><span class="line"><span class="number">0</span></span><br><span class="line">% redBox1 Count                 #调用父类Count函数</span><br><span class="line">% redBox1 <span class="built_in">set</span> count</span><br><span class="line"><span class="number">1</span></span><br><span class="line">% redBox1 get</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/28/机器学习从零开始/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="皇叔">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我是你皇叔">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/28/机器学习从零开始/" class="post-title-link" itemprop="url">机器学习从零开始</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-28 16:12:20" itemprop="dateCreated datePublished" datetime="2019-05-28T16:12:20+08:00">2019-05-28</time>
            

            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/27/PIAS与原生ns2中tcp-cc文件之比对/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="皇叔">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我是你皇叔">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/27/PIAS与原生ns2中tcp-cc文件之比对/" class="post-title-link" itemprop="url">PIAS与原生ns2中tcp.cc文件之比对</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-27 15:19:47 / 修改时间：22:05:35" itemprop="dateCreated datePublished" datetime="2019-05-27T15:19:47+08:00">2019-05-27</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="TcpAgent-TcpAgent-Agent-PT-TCP-类"><a href="#TcpAgent-TcpAgent-Agent-PT-TCP-类" class="headerlink" title="TcpAgent::TcpAgent():Agent(PT_TCP)类"></a>TcpAgent::TcpAgent():Agent(PT_TCP)类</h2>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/25/Python启动/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="皇叔">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我是你皇叔">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/25/Python启动/" class="post-title-link" itemprop="url">Python启动</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-25 14:21:22" itemprop="dateCreated datePublished" datetime="2019-05-25T14:21:22+08:00">2019-05-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-26 14:55:43" itemprop="dateModified" datetime="2019-05-26T14:55:43+08:00">2019-05-26</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#列表<br>在python中使用方括号来表示列表。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bicycles = [<span class="string">'treck'</span>,<span class="string">'cabbondale'</span>]</span><br><span class="line">print(bicycles[<span class="number">0</span>])</span><br></pre></td></tr></table></figure></p>
<p>使用[-1]可以访问列表最后一个元素<code>print(bicycles[-1])</code></p>
<p>##列表的修改<br><code>bicycles[0] = &#39;giant&#39;</code></p>
<p>##添加元素<br>append()方法添加元素至列表末尾；<br>insert()方法添加元素至指定位置。<br><code>bicycles.insert(1,bike)</code></p>
<p>##删除元素<br>del()方法删除元素；<br><code>del bicycles[0]</code><br>pop()方法删除元素并返回元素值；<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">last_ownd=bicycles.pop() //默认删除列表末尾的元素</span><br><span class="line">bicycles.pop(<span class="number">0</span>)          //删除指定位置的元素</span><br></pre></td></tr></table></figure></p>
<p>remove()根据元素值删除元素(仅删除第一个匹配的元素)；<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bicycles.remove(<span class="string">'treck'</span>)</span><br></pre></td></tr></table></figure></p>
<p>##组织列表<br>sort() 排序；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bicycles.sort()             //升序</span><br><span class="line">bicycles.sort(reverse=true) //降序</span><br></pre></td></tr></table></figure></p>
<p>reverse()反转列表元素排列<br>len()返回列表长度</p>
<p>##for循环遍历列表<br>使用for循环。python根据缩进来判断代码行与前一个代码行的关系。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> bicycle <span class="keyword">in</span> bicycles:</span><br><span class="line">    print(bicycle)</span><br></pre></td></tr></table></figure></p>
<p>##使用range()创建数字列表<br>range(A,B)方法生成从A到B-1的值<br>函数list()将range()的结果直接转化为列表<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">numbers = list(range(<span class="number">1</span>,<span class="number">6</span>))  //numbers为数字<span class="number">1</span><span class="number">-5</span>的列表</span><br></pre></td></tr></table></figure></p>
<p>range()方法还能够指定步长如下，步长为2<br><code>range(1,10,2)</code><br>创建列表<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">squares = []</span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">11</span>)</span><br><span class="line">    square = value**<span class="number">2</span></span><br><span class="line">    squares.append(square)</span><br></pre></td></tr></table></figure></p>
<p>##列表解析<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">squares = [value**<span class="number">2</span> <span class="keyword">for</span> value <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">11</span>)]</span><br></pre></td></tr></table></figure></p>
<p>##使用列表的一部分——切片<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bicycles = [<span class="string">'treck'</span>,<span class="string">'cabbondale'</span>,<span class="string">'giant'</span>]</span><br><span class="line">print(bicycles[<span class="number">0</span>:<span class="number">1</span>])</span><br><span class="line">print(bicycles[<span class="number">0</span>:])</span><br><span class="line">print(bicycles[:<span class="number">1</span>])</span><br><span class="line">print(bicycles[<span class="number">-3</span>:]) //最后三个</span><br></pre></td></tr></table></figure></p>
<p>##复制列表<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bicycles = [<span class="string">'treck'</span>,<span class="string">'cabbondale'</span>,<span class="string">'giant'</span>]</span><br><span class="line">my_bikes = bicycles[:]</span><br></pre></td></tr></table></figure></p>
<p>不可以直接写<code>my_bikes = bicycles</code>这样无法得到两个列表。</p>
<p>#选择结构<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a == b) <span class="keyword">and</span> (a != <span class="number">0</span>):</span><br><span class="line">    a=<span class="number">0</span></span><br><span class="line"><span class="keyword">elif</span> b!= <span class="number">0</span>:</span><br><span class="line">    b=<span class="number">0</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    a=b</span><br></pre></td></tr></table></figure></p>
<p>判断特定的值是否包含在列表中可使用关键字in，反之则使用not in。</p>
<p>#字典<br>一个简单的字典如下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alien_0 = &#123;<span class="string">'color'</span>: <span class="string">'green'</span>,<span class="string">'points'</span>: <span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>在Python中，字典是一系列的键值对，键值对之间用逗号分隔。<br>添加键-值对可以直接输入<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alien_0[<span class="string">'x_position'</span>]=<span class="number">0</span></span><br><span class="line">alien_0[<span class="string">'y_position'</span>]=<span class="number">25</span></span><br></pre></td></tr></table></figure></p>
<p>删除键值对<br><code>del alien_0[&#39;points&#39;]</code></p>
<p>##字典的遍历</p>
<ul>
<li><p>使用for循环遍历所有键值对,方法items()返回一个键值对列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for key,value in alien_0.items():</span><br><span class="line">  print(&quot;\nKey:&quot;+key)</span><br></pre></td></tr></table></figure>
</li>
<li><p>key()方法返回所有键的列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> alien_0.keys():</span><br><span class="line">  print(name.title())</span><br></pre></td></tr></table></figure>
</li>
<li><p>对遍历的结果进行排序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> sorted(alien_0.keys()):</span><br><span class="line">  print(name.title())</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>##字典嵌套<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aliens=[alien_0,alien_1,alien_2]</span><br></pre></td></tr></table></figure></p>
<p>#用户输入和while循环</p>
<p>##用户输入</p>
<ul>
<li>input()进行用户输入,该方法会将用户的输入解读为字符串<br><code>message=input(&quot;请输入文本&quot;)</code></li>
<li>使用int()方法可以获取数值输入<br>##while循环<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> message != <span class="string">'quit'</span>:</span><br><span class="line">    message = input()</span><br><span class="line">    print(message)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>break,continue的用法与c类似</p>
<p>#函数</p>
<p>##函数定义<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">abc</span><span class="params">(a)</span></span></span><br><span class="line"><span class="function">    <span class="title">print</span><span class="params">(<span class="string">"hello ,world"</span>+str<span class="params">(a)</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">return</span> <span class="title">a</span>+1</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/14/20190514学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="皇叔">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我是你皇叔">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/14/20190514学习笔记/" class="post-title-link" itemprop="url">20190513个人工作</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-14 09:30:48 / 修改时间：16:23:05" itemprop="dateCreated datePublished" datetime="2019-05-14T09:30:48+08:00">2019-05-14</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>翻看何江师兄发的文档</p>
<h1 id="基于时延的拥塞控制"><a href="#基于时延的拥塞控制" class="headerlink" title="基于时延的拥塞控制"></a>基于时延的拥塞控制</h1><p>将时延的增加视为出现拥塞，时延增加时减小拥塞窗口，延时降低时增加拥塞窗口</p>
<h2 id="Vegas"><a href="#Vegas" class="headerlink" title="Vegas"></a>Vegas</h2><p>通过比较实际吞吐量和期望吞吐量来调节拥塞窗口的大小。<br>期望吞吐量：Expected=cwnd/BaseRTT<br>实际吞吐量：Actual=cwnd/RTT<br><strong>diff</strong>=(Expected-Actual)*BaseRTT<br><strong>BaseRTT</strong>是所有观测来回响应时间的最小值。</p>
<ul>
<li>当a ≤ diff ≤ b 时，拥塞窗口不变</li>
<li>当diff &lt; a 时，拥塞窗口增加</li>
<li>当diff &gt; b 时，拥塞窗口减小  </li>
</ul>
<p>当网络中Vegase算法与基于丢包的拥塞控制算法共存的情况下，后者会去尝试填满网络中的缓冲区，导致Vegas计算的RTT增大，进而使得传输速度越来越慢。</p>
<p>##基于链路容量的拥塞控制<br>实时测量网络带宽和时延，认为网络上报文总量大于带宽和时延的乘积时出现了拥塞。</p>
<h2 id="BBR"><a href="#BBR" class="headerlink" title="BBR"></a>BBR</h2><p>周期性探测网络的容量，交替测量一段时间内的带宽极大值和时延极小值，将其乘积作为拥塞窗口大小，保持拥塞窗口的值始终和网络的容量保持一致。</p>
<ul>
<li><strong>RTprop</strong>：往返时延<br>光信号从A端到B端的最小时延(其实是二倍时延，因为是一个来回)</li>
<li><strong>BtlBW(bottleneck bandwidth)</strong>：瓶颈带宽<br>A到B的链路中，它的带宽取决于最慢的那段链路的带宽，即为瓶颈带宽</li>
<li><strong>inflight data</strong>：干扰数据<br>A已经发出但未收到B返回的ACK数据</li>
<li><strong>BDP(bandwidth-delay product)</strong>：时延带宽积<br>BDP=BtlBW*RTprop</li>
<li><strong>pacing_gain</strong>：控制发送速度的增益系数</li>
<li><strong>cwnd_gain</strong>：窗口增益系数<br>与BDP相乘，控制inflight数量</li>
<li><strong>min_rtt</strong>：windows_min(rtt,10 seconds)</li>
<li><strong>pacing_rate</strong>：pacing_gain * bw</li>
<li><strong>cwnd</strong>：max(cwnd_gain <em> bw </em> min_rtt)</li>
<li><strong>FQ(Fair queue)</strong>：公平队列<br>根据bbr设置的pacing rate将一个cwnd内的数据的发送从“突发到网络”这种行为变换到“平缓发送到网络”的行为。<h4 id="1-测量瓶颈带宽和往返时延"><a href="#1-测量瓶颈带宽和往返时延" class="headerlink" title="1.测量瓶颈带宽和往返时延"></a>1.测量瓶颈带宽和往返时延</h4>BBR解决带宽和延迟无法同时测准的方法是：交替测量带宽和延迟；用一段时间内的带宽极大值和延迟极小值作为估计值。<br>最大带宽的值可以用win_minmax计算。保存一个时间窗口内的“最有意义的最大值或者最小值”，在时间流逝的过程中，时间窗口不断向后华东，在需要时间窗口内极值的时候只需取保存的三个值中的第一个值即可。win_minmax算法本身保证了时间窗口随着时间的华东以及窗口内极值的冒泡更新。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/26/spring笔记day02-spring整合Junit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="皇叔">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我是你皇叔">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/26/spring笔记day02-spring整合Junit/" class="post-title-link" itemprop="url">spring笔记day02-spring整合Junit</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-26 20:03:48" itemprop="dateCreated datePublished" datetime="2019-04-26T20:03:48+08:00">2019-04-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-28 00:23:33" itemprop="dateModified" datetime="2019-04-28T00:23:33+08:00">2019-04-28</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="spring笔记day02-spring整合Junit"><a href="#spring笔记day02-spring整合Junit" class="headerlink" title="spring笔记day02-spring整合Junit"></a>spring笔记day02-spring整合Junit</h2><p>应用程序的入口为main()方法。junit单元测试中，没有main()方法也能执行，因为junit集成了一个main()方法。该方法可以判断当前测试类中哪些方法有<code>@Test</code>注解。junit就会让有注解的方法执行。junit并不会馆管我们是否采用spring框架。因此在执行测试方法时，junit不会为我们读取配置文件/配置类创建spring核心容器。所以就算写了<code>@Autowired</code>注解，也不会为我们注入数据。<br>解决思路：使用能加载spring容器的main()方法。<br>解决方法：</p>
<ul>
<li>1.导入spring-test的jar包  </li>
<li>2.使用junit提供的注解把原有的main（）方法替换成spring提供的@Runwith注解  </li>
<li>3.告知spring的运行器（基于xml还是注解），并说明位置<br>@ContextConfiguration:（当使用spring5.x版本时，要求junit的jar包必须是4.1.2及以上）<br>location:指定xml文件的位置，加上classpath关键字，表示在类路径下<br>classes:指定注解类所在的位置  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(classes = SpringConfiguration.class)</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = <span class="string">"classpath:bean.xml"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"><span class="comment">//    private ApplicationContext ac;</span></span><br><span class="line">    <span class="keyword">private</span> IAccountService as = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.执行方法</span></span><br><span class="line">        List&lt;Account&gt; accounts = as.findAllAcccount();</span><br><span class="line">        <span class="keyword">for</span>(Account account : accounts)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/26/spring笔记day02-spring的新注解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="皇叔">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我是你皇叔">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/26/spring笔记day02-spring的新注解/" class="post-title-link" itemprop="url">spring笔记day02(spring的新注解)</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-26 14:53:29 / 修改时间：20:24:37" itemprop="dateCreated datePublished" datetime="2019-04-26T14:53:29+08:00">2019-04-26</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="spring笔记day02-spring的新注解"><a href="#spring笔记day02-spring的新注解" class="headerlink" title="spring笔记day02(spring的新注解)"></a>spring笔记day02(spring的新注解)</h1><p>本篇解决无法脱离xml文件的问题</p>
<h2 id="Configuration和ComponentScan"><a href="#Configuration和ComponentScan" class="headerlink" title="Configuration和ComponentScan"></a>Configuration和ComponentScan</h2><ul>
<li>Configuration<br>作用：指定当前类是一个配置类</li>
<li>ComponentScan<br>作用：通过注解指定spring在创建容器时要扫描的包<br>属性：value = backPackages (要扫描的包)<br>使用此注解就相当于使用了xml文件中的<code>&lt;context:component-scan base-package=&quot;com.itheima&quot;&gt;&lt;/context:component-scan&gt;</code></li>
<li>Bean：把当前方法的返回值作为bean对象存入spring的ioc容器中<br>  属性： name：指定bean的id。默认值为当前方法的名称。</li>
<li>细节：当我们使用注解配置方法时，如果方法有参数，spring框架会去容器中查找有没有可用的bean对象,查找方式和Autowired注解是一样的。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.itheima"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个queryrunner对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"runner"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> QueryRunner <span class="title">createQueryRunner</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> QueryRunner(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建数据源对象</span></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"dataSource"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ComboPooledDataSource ds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">            ds.setDriverClass(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">            ds.setJdbcUrl(<span class="string">"jdbc:mysql://localhost:3306/eesy"</span>);</span><br><span class="line">            ds.setUser(<span class="string">"root"</span>);</span><br><span class="line">            ds.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">            <span class="keyword">return</span> ds;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在测试类中使用<code>AnnotationConfigApplicationContext(SpringConfiguration.class)</code>方法获取容器。这样我们就可以删掉bean.xml文件了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.获取容器</span></span><br><span class="line">        <span class="comment">//ApplicationContext ac = new ClassPathXmlApplicationContext("bean.xml");</span></span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfiguration.class);</span><br><span class="line">        <span class="comment">//2.得到业务层对象</span></span><br><span class="line">        IAccountService as = ac.getBean(<span class="string">"accountService"</span>,IAccountService.class);</span><br><span class="line">        <span class="comment">//3.执行方法</span></span><br><span class="line">        List&lt;Account&gt; accounts = as.findAllAcccount();</span><br></pre></td></tr></table></figure></p>
<p>注意，此时的runner已经是单例的，而我们之前使用的是多例对象，这样会造成如果有多个用户同时使用接口时会产生线程冲突。因此我们需要加上<code>@Scope</code>注解。</p>
<h3 id="一些-Configuration注解的细节"><a href="#一些-Configuration注解的细节" class="headerlink" title="一些@Configuration注解的细节"></a>一些@Configuration注解的细节</h3><p>我们会发现，在去掉@Configuration之后程序依然能够运行。仿佛没有任何存在的意义。当配置类作为AnnotationConfig。。。对象创建的参数时，该注解可以不写。如<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext ac = <span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfiguration.class, JdbcConfig.class);</span><br></pre></td></tr></table></figure></p>
<p>如果没有在这个参数表中的话就要加上Configuration注解并配置扫描的包。这个问题可以使用下面的Import注解解决。</p>
<h2 id="Import"><a href="#Import" class="headerlink" title="Import"></a>Import</h2><p>作用：用于导入其他的配置类<br>属性：value：用于指定其他配置类的字节码。当使用Import注解后，有import注解的类就是主（父）配置类，导入的都是子配置类。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import</span>(JdbcConfig.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>到了这一步，我们发现数据源的配置还是写死的状态。接下来我们将使用另一个注解解决这个问题。</p>
<h2 id="PropertySource"><a href="#PropertySource" class="headerlink" title="PropertySource"></a>PropertySource</h2><ul>
<li>作用：用于指定properties文件的位置</li>
<li>属性：<br>value：文件名称和路径<br>关键字：classpath表示类路径下<br>我们首先新建一个.properites文件。在里面配置数据源。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/eesy</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=123456</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>随后在我们的代码中加入注解。再将数据源中的字符串更换成我们所书写的变量。通过变量存储.properties文件中的各个值。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.driver&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.username&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;jdbc.password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"runner"</span>)</span><br><span class="line">    <span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> QueryRunner <span class="title">createQueryRunner</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> QueryRunner(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建数据源对象</span></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"dataSource"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ComboPooledDataSource ds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">            ds.setDriverClass(driver);</span><br><span class="line">            ds.setJdbcUrl(url);</span><br><span class="line">            ds.setUser(username);</span><br><span class="line">            ds.setPassword(password);</span><br><span class="line">            <span class="keyword">return</span> ds;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:jdbcConfig.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样我们就完全摆脱了.xml文件。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我们使用了纯xml文件的方式和纯注解的方式以及xml和注解混用的方式来进行对象的创建和容器的注入。那么具体使用哪种方法呢。<br>在我们有权利选择的情况下。最好使用两种方法混用的方式。如果该类是别人写好的封装成jar包的类，我们最好使用xml的方式来进行。如果是我们自己写的，使用注解更方便。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">皇叔</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">皇叔</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>




  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
